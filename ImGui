local ImGui = {
	Animations = {
		Buttons = {
			MouseEnter = {
				BackgroundTransparency = 0.5,
			},
			MouseLeave = {
				BackgroundTransparency = 0.7,
			} 
		},
		Tabs = {
			MouseEnter = {
				BackgroundTransparency = 0.5,
			},
			MouseLeave = {
				BackgroundTransparency = 1,
			} 
		},
		Inputs = {
			MouseEnter = {
				BackgroundTransparency = 0,
			},
			MouseLeave = {
				BackgroundTransparency = 0.5,
			} 
		},
		WindowBorder = {
			Selected = {
				Transparency = 0,
				Thickness = 1
			},
			Deselected = {
				Transparency = 0.7,
				Thickness = 1
			}
		},
		Sliders = {
			MouseEnter = {
				BackgroundTransparency = 0.3,
			},
			MouseLeave = {
				BackgroundTransparency = 0.5,
			}
		},
		Dropdowns = {
			MouseEnter = {
				BackgroundTransparency = 0.4,
			},
			MouseLeave = {
				BackgroundTransparency = 0.6,
			}
		}
	},

	Windows = {},
	Animation = TweenInfo.new(0.1),
	UIAssetId = "rbxassetid://76246418997296"
}


--// Universal functions
local NullFunction = function() end
local CloneRef = cloneref or function(_)return _ end
local function GetService(...): ServiceProvider
	return CloneRef(game:GetService(...))
end

function ImGui:Warn(...)
	if self.NoWarnings then return end
	return warn("[IMGUI]", ...)
end

--// Services 
local TweenService: TweenService = GetService("TweenService")
local UserInputService: UserInputService = GetService("UserInputService")
local Players: Players = GetService("Players")
local CoreGui = GetService("CoreGui")
local RunService: RunService = GetService("RunService")

--// LocalPlayer
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer.PlayerGui
local Mouse = LocalPlayer:GetMouse()

--// ImGui Config
local IsStudio = RunService:IsStudio()
ImGui.NoWarnings = not IsStudio

--// Prefabs
function ImGui:FetchUI()
	--// Cache check 
	local CacheName = "DepsoImGui"
	if _G[CacheName] then
		self:Warn("Prefabs loaded from Cache")
		return _G[CacheName]
	end

	local UI = nil

	--// Universal
	if not IsStudio then
		local UIAssetId = ImGui.UIAssetId
		UI = game:GetObjects(UIAssetId)[1]
	else --// Studio
		local UIName = "DepsoImGui"
		UI = PlayerGui:FindFirstChild(UIName) or script.DepsoImGui
	end

	_G[CacheName] = UI
	return UI
end

local UI = ImGui:FetchUI()
local Prefabs = UI.Prefabs
ImGui.Prefabs = Prefabs
Prefabs.Visible = false

--// Styles
local AddionalStyles = {
	[{
		Name="Border"
	}] = function(GuiObject: GuiObject, Value, Class)
		local Outline = GuiObject:FindFirstChildOfClass("UIStroke")
		if not Outline then return end

		local BorderThickness = Class.BorderThickness
		if BorderThickness then
			Outline.Thickness = BorderThickness
		end

		Outline.Enabled = Value
	end,

	[{
		Name="Ratio"
	}] = function(GuiObject: GuiObject, Value, Class)
		local RatioAxis = Class.RatioAxis or "Height"
		local AspectRatio = Class.Ratio or 4/3
		local AspectType = Class.AspectType or Enum.AspectType.ScaleWithParentSize

		local Ratio = GuiObject:FindFirstChildOfClass("UIAspectRatioConstraint")
		if not Ratio then
			Ratio = ImGui:CreateInstance("UIAspectRatioConstraint", GuiObject)
		end

		Ratio.DominantAxis = Enum.DominantAxis[RatioAxis]
		Ratio.AspectType = AspectType
		Ratio.AspectRatio = AspectRatio
	end,

	[{
		Name="CornerRadius",
		Recursive=true
	}] = function(GuiObject: GuiObject, Value, Class)
		local UICorner = GuiObject:FindFirstChildOfClass("UICorner")
		if not UICorner then
			UICorner = ImGui:CreateInstance("UICorner", GuiObject)
		end

		UICorner.CornerRadius = Class.CornerRadius
	end,

	[{
		Name="Label"
	}] = function(GuiObject: GuiObject, Value, Class)
		local Label = GuiObject:FindFirstChild("Label")
		if not Label then return end

		Label.Text = Class.Label
		function Class:SetLabel(Text)
			Label.Text = Text
			return Class
		end
	end,

	[{
		Name="NoGradient",
		Aliases = {"NoGradientAll"},
		Recursive=true
	}] = function(GuiObject: GuiObject, Value, Class)
		local UIGradient = GuiObject:FindFirstChildOfClass("UIGradient")
		if not UIGradient then return end
		UIGradient.Enabled = not Value
	end,

	--// Addional functions for classes
	[{
		Name="Callback"
	}] = function(GuiObject: GuiObject, Value, Class)
		function Class:SetCallback(NewCallback)
			Class.Callback = NewCallback
			return Class
		end
		function Class:FireCallback(NewCallback)
			return Class.Callback(GuiObject)
		end
	end,

	[{
		Name="Value"
	}] = function(GuiObject: GuiObject, Value, Class)
		function Class:GetValue()
			return Class.Value
		end
	end,
}

function ImGui:GetName(Name: string)
	local Format = "%s_"
	return Format:format(Name)
end

function ImGui:CreateInstance(Class, Parent, Properties)
	local Instance = Instance.new(Class, Parent)
	for Key, Value in next, Properties or {} do
		Instance[Key] = Value
	end
	return Instance
end

function ImGui:ApplyColors(ColorOverwrites, GuiObject: GuiObject, ElementType: string)
	for Info, Value in next, ColorOverwrites do
		local Key = Info
		local Recursive = false

		if typeof(Info) == "table" then
			Key = Info.Name or ""
			Recursive = Info.Recursive or false
		end

		--// Child object
		if typeof(Value) == "table" then
			local Element = GuiObject:FindFirstChild(Key, Recursive)

			if not Element then 
				if ElementType == "Window" then
					Element = GuiObject.Content:FindFirstChild(Key, Recursive)
					if not Element then continue end
				else 
					warn(Key, "was not found in", GuiObject)
					warn("Table:", Value)

					continue
				end
			end

			ImGui:ApplyColors(Value, Element)
			continue
		end

		--// Set property
		GuiObject[Key] = Value
	end
end

function ImGui:CheckStyles(GuiObject: GuiObject, Class, Colors)
	--// Addional styles
	for Info, Callback in next, AddionalStyles do
		local Value = Class[Info.Name]
		local Aliases = Info.Aliases

		if Aliases and not Value then
			for _, Alias in Info.Aliases do
				Value = Class[Alias]
				if Value then break end
			end
		end
		if Value == nil then continue end

		--// Stylise children
		Callback(GuiObject, Value, Class)
		if Info.Recursive then
			for _, Child in next, GuiObject:GetChildren() do
				Callback(Child, Value, Class)
			end
		end
	end

	--// Label functions/Styliser
	local ElementType = GuiObject.Name
	GuiObject.Name = self:GetName(ElementType)

	--// Apply Colors
	local Colors = Colors or {}
	local ColorOverwrites = Colors[ElementType]

	if ColorOverwrites then
		ImGui:ApplyColors(ColorOverwrites, GuiObject, ElementType)
	end

	--// Set properties
	for Key, Value in next, Class do
		pcall(function() --// If the property does not exist
			GuiObject[Key] = Value
		end)
	end
end

function ImGui:MergeMetatables(Class, Instance: GuiObject)
	local Metadata = {}
	Metadata.__index = function(self, Key)
		local suc, Value = pcall(function()
			local Value = Instance[Key]
			if typeof(Value) == "function" then
				return function(...)
					return Value(Instance, ...)
				end
			end
			return Value
		end)
		return suc and Value or Class[Key]
	end

	Metadata.__newindex = function(self, Key, Value)
		local Key2 = Class[Key]
		if Key2 ~= nil or typeof(Value) == "function" then
			Class[Key] = Value
		else
			Instance[Key] = Value
		end
	end

	return setmetatable({}, Metadata)
end

function ImGui:Concat(Table, Separator: " ") 
	local Concatenated = ""
	for Index, String in next, Table do
		Concatenated ..= tostring(String) .. (Index ~= #Table and Separator or "")
	end
	return Concatenated
end

function ImGui:ContainerClass(Frame: Frame, Class, Window)
	local ContainerClass = Class or {}
	local WindowConfig = ImGui.Windows[Window]

	function ContainerClass:NewInstance(Instance: Frame, Class, Parent)
		--// Config
		Class = Class or {}

		--// Set Parent
		Instance.Parent = Parent or Frame
		Instance.Visible = true

		--// TODO
		if WindowConfig.NoGradientAll then
			Class.NoGradient = true
		end

		local Colors = WindowConfig.Colors
		ImGui:CheckStyles(Instance, Class, Colors)

		--// External callback check
		if Class.NewInstanceCallback then
			Class.NewInstanceCallback(Instance)
		end

		return Class
	end

	--// ============================================
	--// NEW: GROUPBOX ELEMENT
	--// ============================================
	function ContainerClass:AddGroupbox(Class)
		Class = Class or {}
		local Name = Class.Name or "Groupbox"
		
		--// Create groupbox container
		local Groupbox = ImGui:CreateInstance("Frame", Frame)
		Groupbox.Name = "Groupbox"
		Groupbox.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
		Groupbox.BorderSizePixel = 0
		Groupbox.Size = UDim2.new(1, -10, 0, 0)
		Groupbox.AutomaticSize = Enum.AutomaticSize.Y
		Groupbox.LayoutOrder = Class.LayoutOrder or 0
		
		--// Add corner
		local Corner = ImGui:CreateInstance("UICorner", Groupbox)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Add stroke
		local Stroke = ImGui:CreateInstance("UIStroke", Groupbox)
		Stroke.Color = Color3.fromRGB(40, 40, 40)
		Stroke.Thickness = 1
		
		--// Add padding
		local Padding = ImGui:CreateInstance("UIPadding", Groupbox)
		Padding.PaddingTop = UDim.new(0, 8)
		Padding.PaddingBottom = UDim.new(0, 8)
		Padding.PaddingLeft = UDim.new(0, 8)
		Padding.PaddingRight = UDim.new(0, 8)
		
		--// Title label
		local Title = ImGui:CreateInstance("TextLabel", Groupbox)
		Title.Name = "Title"
		Title.Text = Name
		Title.Font = Enum.Font.Code
		Title.TextSize = 14
		Title.TextColor3 = Color3.new(1, 1, 1)
		Title.BackgroundTransparency = 1
		Title.Size = UDim2.new(1, 0, 0, 20)
		Title.TextXAlignment = Enum.TextXAlignment.Left
		
		--// Content container
		local Content = ImGui:CreateInstance("Frame", Groupbox)
		Content.Name = "Content"
		Content.BackgroundTransparency = 1
		Content.Size = UDim2.new(1, 0, 0, 0)
		Content.Position = UDim2.new(0, 0, 0, 25)
		Content.AutomaticSize = Enum.AutomaticSize.Y
		
		--// Layout for content
		local Layout = ImGui:CreateInstance("UIListLayout", Content)
		Layout.Padding = UDim.new(0, 5)
		Layout.SortOrder = Enum.SortOrder.LayoutOrder
		
		--// Apply styles
		ImGui:CheckStyles(Groupbox, Class, WindowConfig.Colors)
		
		--// Create container class for groupbox
		local GroupboxClass = {
			Frame = Groupbox,
			Content = Content,
			Title = Title
		}
		
		function GroupboxClass:SetTitle(NewTitle)
			Title.Text = NewTitle
			return self
		end
		
		--// Return container with all UI methods
		return ImGui:ContainerClass(Content, GroupboxClass, Window)
	end

	--// ============================================
	--// NEW: SEPARATOR ELEMENT
	--// ============================================
	function ContainerClass:AddSeparator(Class)
		Class = Class or {}
		
		local Separator = ImGui:CreateInstance("Frame", Frame)
		Separator.Name = "Separator"
		Separator.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
		Separator.BorderSizePixel = 0
		Separator.Size = UDim2.new(1, -10, 0, 1)
		Separator.LayoutOrder = Class.LayoutOrder or 0
		
		ImGui:CheckStyles(Separator, Class, WindowConfig.Colors)
		
		return Class
	end

	--// ============================================
	--// NEW: PARAGRAPH/LABEL ELEMENT
	--// ============================================
	function ContainerClass:AddParagraph(Class)
		Class = Class or {}
		local Text = Class.Text or ""
		local Title = Class.Title or ""
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "Paragraph"
		Container.BackgroundTransparency = 1
		Container.Size = UDim2.new(1, -10, 0, 0)
		Container.AutomaticSize = Enum.AutomaticSize.Y
		Container.LayoutOrder = Class.LayoutOrder or 0
		
		if Title ~= "" then
			local TitleLabel = ImGui:CreateInstance("TextLabel", Container)
			TitleLabel.Name = "Title"
			TitleLabel.Text = Title
			TitleLabel.Font = Enum.Font.CodeBold
			TitleLabel.TextSize = 14
			TitleLabel.TextColor3 = Color3.new(1, 1, 1)
			TitleLabel.BackgroundTransparency = 1
			TitleLabel.Size = UDim2.new(1, 0, 0, 18)
			TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
			TitleLabel.TextYAlignment = Enum.TextYAlignment.Top
		end
		
		local ContentLabel = ImGui:CreateInstance("TextLabel", Container)
		ContentLabel.Name = "Content"
		ContentLabel.Text = Text
		ContentLabel.Font = Enum.Font.Code
		ContentLabel.TextSize = 12
		ContentLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
		ContentLabel.BackgroundTransparency = 1
		ContentLabel.Size = UDim2.new(1, 0, 0, 0)
		ContentLabel.Position = Title ~= "" and UDim2.new(0, 0, 0, 20) or UDim2.new(0, 0, 0, 0)
		ContentLabel.AutomaticSize = Enum.AutomaticSize.Y
		ContentLabel.TextXAlignment = Enum.TextXAlignment.Left
		ContentLabel.TextYAlignment = Enum.TextYAlignment.Top
		ContentLabel.TextWrapped = true
		
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		Class.Container = Container
		Class.Label = ContentLabel
		
		function Class:SetText(NewText)
			ContentLabel.Text = NewText
			return self
		end
		
		function Class:SetTitle(NewTitle)
			if Title ~= "" then
				Container.Title.Text = NewTitle
			end
			return self
		end
		
		return Class
	end

	--// ============================================
	--// ENHANCED: BUTTON ELEMENT
	--// ============================================
	function ContainerClass:AddButton(Class)
		Class = Class or {}
		local Name = Class.Name or "Button"
		local Button: TextButton = Prefabs.Button:Clone()
		
		self:NewInstance(Button, Class)
		
		--// Set text
		Button.Text = Name
		
		--// Add icon support
		if Class.Icon then
			local Icon = ImGui:CreateInstance("ImageLabel", Button)
			Icon.Name = "Icon"
			Icon.Image = Class.Icon
			Icon.Size = UDim2.new(0, 16, 0, 16)
			Icon.Position = UDim2.new(0, 5, 0.5, -8)
			Icon.BackgroundTransparency = 1
			Icon.ScaleType = Enum.ScaleType.Fit
			
			Button.TextXAlignment = Enum.TextXAlignment.Center
			Button.UIPadding.PaddingLeft = UDim.new(0, 25)
		end
		
		--// Animations
		ImGui:ApplyAnimations(Button, "Buttons")
		
		--// Callback
		Class.Callback = Class.Callback or NullFunction
		Button.Activated:Connect(function()
			Class.Callback(Class)
		end)
		
		Class.Button = Button
		
		function Class:SetText(NewText)
			Button.Text = NewText
			return self
		end
		
		function Class:SetEnabled(Enabled)
			Button.Active = Enabled
			Button.BackgroundTransparency = Enabled and 0.7 or 0.9
			return self
		end
		
		return Class
	end

	--// ============================================
	--// NEW: TOGGLE/CHECKBOX ELEMENT
	--// ============================================
	function ContainerClass:AddToggle(Class)
		Class = Class or {}
		local Name = Class.Name or "Toggle"
		local Value = Class.Value or false
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "Toggle"
		Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		Container.BorderSizePixel = 0
		Container.Size = UDim2.new(1, -10, 0, 30)
		Container.LayoutOrder = Class.LayoutOrder or 0
		
		--// Corner
		local Corner = ImGui:CreateInstance("UICorner", Container)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Label
		local Label = ImGui:CreateInstance("TextLabel", Container)
		Label.Name = "Label"
		Label.Text = Name
		Label.Font = Enum.Font.Code
		Label.TextSize = 13
		Label.TextColor3 = Color3.new(1, 1, 1)
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(1, -40, 1, 0)
		Label.Position = UDim2.new(0, 10, 0, 0)
		Label.TextXAlignment = Enum.TextXAlignment.Left
		
		--// Checkbox
		local Checkbox = ImGui:CreateInstance("Frame", Container)
		Checkbox.Name = "Checkbox"
		Checkbox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
		Checkbox.BorderSizePixel = 0
		Checkbox.Size = UDim2.new(0, 18, 0, 18)
		Checkbox.Position = UDim2.new(1, -25, 0.5, -9)
		
		local CheckboxCorner = ImGui:CreateInstance("UICorner", Checkbox)
		CheckboxCorner.CornerRadius = UDim.new(0, 3)
		
		local CheckboxStroke = ImGui:CreateInstance("UIStroke", Checkbox)
		CheckboxStroke.Color = Color3.fromRGB(60, 60, 60)
		CheckboxStroke.Thickness = 1
		
		--// Checkmark
		local Checkmark = ImGui:CreateInstance("TextLabel", Checkbox)
		Checkmark.Name = "Checkmark"
		Checkmark.Text = "✓"
		Checkmark.Font = Enum.Font.CodeBold
		Checkmark.TextSize = 16
		Checkmark.TextColor3 = Color3.fromRGB(125, 85, 255)
		Checkmark.BackgroundTransparency = 1
		Checkmark.Size = UDim2.new(1, 0, 1, 0)
		Checkmark.Visible = Value
		
		--// Button
		local Button = ImGui:CreateInstance("TextButton", Container)
		Button.Name = "Button"
		Button.Text = ""
		Button.BackgroundTransparency = 1
		Button.Size = UDim2.new(1, 0, 1, 0)
		
		--// Apply styles
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		--// Functionality
		Class.Value = Value
		Class.Callback = Class.Callback or NullFunction
		Class.Container = Container
		Class.Checkbox = Checkbox
		
		local function UpdateValue(NewValue)
			Class.Value = NewValue
			Checkmark.Visible = NewValue
			CheckboxStroke.Color = NewValue and Color3.fromRGB(125, 85, 255) or Color3.fromRGB(60, 60, 60)
			Class.Callback(NewValue)
		end
		
		Button.Activated:Connect(function()
			UpdateValue(not Class.Value)
		end)
		
		function Class:SetValue(NewValue)
			UpdateValue(NewValue)
			return self
		end
		
		function Class:GetValue()
			return Class.Value
		end
		
		--// Animations
		ImGui:ConnectHover({
			Parent = Container,
			OnInput = function(MouseHovering, Input)
				if Input.UserInputType.Name:find("Mouse") then
					local Transparency = MouseHovering and 0.5 or 0.7
					ImGui:Tween(Container, {BackgroundTransparency = Transparency})
				end
			end,
		})
		
		return Class
	end

	--// ============================================
	--// NEW: SLIDER ELEMENT
	--// ============================================
	function ContainerClass:AddSlider(Class)
		Class = Class or {}
		local Name = Class.Name or "Slider"
		local Min = Class.Min or 0
		local Max = Class.Max or 100
		local Default = Class.Default or Min
		local Increment = Class.Increment or 1
		local Suffix = Class.Suffix or ""
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "Slider"
		Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		Container.BorderSizePixel = 0
		Container.Size = UDim2.new(1, -10, 0, 45)
		Container.LayoutOrder = Class.LayoutOrder or 0
		
		--// Corner
		local Corner = ImGui:CreateInstance("UICorner", Container)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Label
		local Label = ImGui:CreateInstance("TextLabel", Container)
		Label.Name = "Label"
		Label.Text = Name
		Label.Font = Enum.Font.Code
		Label.TextSize = 13
		Label.TextColor3 = Color3.new(1, 1, 1)
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(0.6, 0, 0, 20)
		Label.Position = UDim2.new(0, 10, 0, 5)
		Label.TextXAlignment = Enum.TextXAlignment.Left
		
		--// Value label
		local ValueLabel = ImGui:CreateInstance("TextLabel", Container)
		ValueLabel.Name = "ValueLabel"
		ValueLabel.Text = tostring(Default) .. Suffix
		ValueLabel.Font = Enum.Font.Code
		ValueLabel.TextSize = 13
		ValueLabel.TextColor3 = Color3.fromRGB(125, 85, 255)
		ValueLabel.BackgroundTransparency = 1
		ValueLabel.Size = UDim2.new(0.4, -10, 0, 20)
		ValueLabel.Position = UDim2.new(0.6, 0, 0, 5)
		ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
		
		--// Slider background
		local SliderBg = ImGui:CreateInstance("Frame", Container)
		SliderBg.Name = "SliderBackground"
		SliderBg.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
		SliderBg.BorderSizePixel = 0
		SliderBg.Size = UDim2.new(1, -20, 0, 6)
		SliderBg.Position = UDim2.new(0, 10, 1, -12)
		
		local SliderBgCorner = ImGui:CreateInstance("UICorner", SliderBg)
		SliderBgCorner.CornerRadius = UDim.new(0, 3)
		
		--// Slider fill
		local SliderFill = ImGui:CreateInstance("Frame", SliderBg)
		SliderFill.Name = "Fill"
		SliderFill.BackgroundColor3 = Color3.fromRGB(125, 85, 255)
		SliderFill.BorderSizePixel = 0
		SliderFill.Size = UDim2.new(0, 0, 1, 0)
		
		local SliderFillCorner = ImGui:CreateInstance("UICorner", SliderFill)
		SliderFillCorner.CornerRadius = UDim.new(0, 3)
		
		--// Slider button
		local SliderButton = ImGui:CreateInstance("TextButton", SliderBg)
		SliderButton.Name = "Button"
		SliderButton.Text = ""
		SliderButton.BackgroundTransparency = 1
		SliderButton.Size = UDim2.new(1, 0, 1, 8)
		SliderButton.Position = UDim2.new(0, 0, 0, -4)
		
		--// Apply styles
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		--// Functionality
		Class.Value = Default
		Class.Min = Min
		Class.Max = Max
		Class.Increment = Increment
		Class.Callback = Class.Callback or NullFunction
		Class.Container = Container
		
		local function Round(Number, Factor)
			local Result = math.floor(Number / Factor + 0.5) * Factor
			return Factor == math.floor(Factor) and math.floor(Result) or Result
		end
		
		local function UpdateValue(NewValue)
			NewValue = math.clamp(Round(NewValue, Increment), Min, Max)
			Class.Value = NewValue
			
			local Percentage = (NewValue - Min) / (Max - Min)
			SliderFill.Size = UDim2.new(Percentage, 0, 1, 0)
			ValueLabel.Text = tostring(NewValue) .. Suffix
			
			Class.Callback(NewValue)
		end
		
		local Dragging = false
		
		SliderButton.InputBegan:Connect(function(Input)
			if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
				Dragging = true
				
				local function Update()
					local MousePos = UserInputService:GetMouseLocation().X
					local SliderPos = SliderBg.AbsolutePosition.X
					local SliderSize = SliderBg.AbsoluteSize.X
					
					local Percentage = math.clamp((MousePos - SliderPos) / SliderSize, 0, 1)
					local Value = Min + (Max - Min) * Percentage
					
					UpdateValue(Value)
				end
				
				Update()
				
				local MoveConnection
				MoveConnection = UserInputService.InputChanged:Connect(function(Input2)
					if Input2.UserInputType == Enum.UserInputType.MouseMovement or Input2.UserInputType == Enum.UserInputType.Touch then
						if Dragging then
							Update()
						end
					end
				end)
				
				local ReleaseConnection
				ReleaseConnection = UserInputService.InputEnded:Connect(function(Input2)
					if Input2.UserInputType == Enum.UserInputType.MouseButton1 or Input2.UserInputType == Enum.UserInputType.Touch then
						Dragging = false
						MoveConnection:Disconnect()
						ReleaseConnection:Disconnect()
					end
				end)
			end
		end)
		
		function Class:SetValue(NewValue)
			UpdateValue(NewValue)
			return self
		end
		
		function Class:GetValue()
			return Class.Value
		end
		
		--// Initialize
		UpdateValue(Default)
		
		return Class
	end

	--// ============================================
	--// NEW: DROPDOWN ELEMENT
	--// ============================================
	function ContainerClass:AddDropdown(Class)
		Class = Class or {}
		local Name = Class.Name or "Dropdown"
		local Values = Class.Values or {}
		local Default = Class.Default or ""
		local Multi = Class.Multi or false
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "Dropdown"
		Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		Container.BorderSizePixel = 0
		Container.Size = UDim2.new(1, -10, 0, 30)
		Container.LayoutOrder = Class.LayoutOrder or 0
		Container.ClipsDescendants = false
		
		--// Corner
		local Corner = ImGui:CreateInstance("UICorner", Container)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Label
		local Label = ImGui:CreateInstance("TextLabel", Container)
		Label.Name = "Label"
		Label.Text = Name
		Label.Font = Enum.Font.Code
		Label.TextSize = 13
		Label.TextColor3 = Color3.new(1, 1, 1)
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(0.5, 0, 1, 0)
		Label.Position = UDim2.new(0, 10, 0, 0)
		Label.TextXAlignment = Enum.TextXAlignment.Left
		
		--// Display value
		local Display = ImGui:CreateInstance("TextLabel", Container)
		Display.Name = "Display"
		Display.Text = Default ~= "" and Default or "None"
		Display.Font = Enum.Font.Code
		Display.TextSize = 12
		Display.TextColor3 = Color3.fromRGB(150, 150, 150)
		Display.BackgroundTransparency = 1
		Display.Size = UDim2.new(0.5, -30, 1, 0)
		Display.Position = UDim2.new(0.5, 0, 0, 0)
		Display.TextXAlignment = Enum.TextXAlignment.Right
		Display.TextTruncate = Enum.TextTruncate.AtEnd
		
		--// Arrow
		local Arrow = ImGui:CreateInstance("TextLabel", Container)
		Arrow.Name = "Arrow"
		Arrow.Text = "▼"
		Arrow.Font = Enum.Font.Code
		Arrow.TextSize = 10
		Arrow.TextColor3 = Color3.new(1, 1, 1)
		Arrow.BackgroundTransparency = 1
		Arrow.Size = UDim2.new(0, 20, 1, 0)
		Arrow.Position = UDim2.new(1, -20, 0, 0)
		
		--// Button
		local Button = ImGui:CreateInstance("TextButton", Container)
		Button.Name = "Button"
		Button.Text = ""
		Button.BackgroundTransparency = 1
		Button.Size = UDim2.new(1, 0, 1, 0)
		Button.ZIndex = 5
		
		--// Dropdown menu
		local Menu = ImGui:CreateInstance("Frame", Container)
		Menu.Name = "Menu"
		Menu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
		Menu.BorderSizePixel = 0
		Menu.Position = UDim2.new(0, 0, 1, 5)
		Menu.Size = UDim2.new(1, 0, 0, 0)
		Menu.Visible = false
		Menu.ZIndex = 10
		Menu.ClipsDescendants = true
		
		local MenuCorner = ImGui:CreateInstance("UICorner", Menu)
		MenuCorner.CornerRadius = UDim.new(0, 4)
		
		local MenuStroke = ImGui:CreateInstance("UIStroke", Menu)
		MenuStroke.Color = Color3.fromRGB(60, 60, 60)
		MenuStroke.Thickness = 1
		
		--// Menu scroll
		local MenuScroll = ImGui:CreateInstance("ScrollingFrame", Menu)
		MenuScroll.Name = "Scroll"
		MenuScroll.BackgroundTransparency = 1
		MenuScroll.BorderSizePixel = 0
		MenuScroll.Size = UDim2.new(1, 0, 1, 0)
		MenuScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
		MenuScroll.ScrollBarThickness = 4
		MenuScroll.ScrollBarImageColor3 = Color3.fromRGB(125, 85, 255)
		MenuScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
		
		local MenuLayout = ImGui:CreateInstance("UIListLayout", MenuScroll)
		MenuLayout.Padding = UDim.new(0, 2)
		MenuLayout.SortOrder = Enum.SortOrder.LayoutOrder
		
		local MenuPadding = ImGui:CreateInstance("UIPadding", MenuScroll)
		MenuPadding.PaddingTop = UDim.new(0, 5)
		MenuPadding.PaddingBottom = UDim.new(0, 5)
		MenuPadding.PaddingLeft = UDim.new(0, 5)
		MenuPadding.PaddingRight = UDim.new(0, 5)
		
		--// Apply styles
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		--// Functionality
		Class.Value = Multi and {} or Default
		Class.Values = Values
		Class.Multi = Multi
		Class.Callback = Class.Callback or NullFunction
		Class.Container = Container
		Class.Menu = Menu
		Class.Open = false
		
		local function UpdateDisplay()
			if Multi then
				local Selected = {}
				for Value, _ in pairs(Class.Value) do
					table.insert(Selected, Value)
				end
				Display.Text = #Selected > 0 and table.concat(Selected, ", ") or "None"
			else
				Display.Text = Class.Value ~= "" and Class.Value or "None"
			end
		end
		
		local function ToggleMenu()
			Class.Open = not Class.Open
			Menu.Visible = Class.Open
			
			if Class.Open then
				local ItemCount = #MenuScroll:GetChildren() - 2 -- Subtract layout and padding
				local MenuHeight = math.min(ItemCount * 25 + 10, 200)
				Menu.Size = UDim2.new(1, 0, 0, MenuHeight)
				Arrow.Rotation = 180
			else
				Menu.Size = UDim2.new(1, 0, 0, 0)
				Arrow.Rotation = 0
			end
		end
		
		local function CreateOption(Value)
			local Option = ImGui:CreateInstance("TextButton", MenuScroll)
			Option.Name = Value
			Option.Text = ""
			Option.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
			Option.BorderSizePixel = 0
			Option.Size = UDim2.new(1, -10, 0, 22)
			Option.AutoButtonColor = false
			
			local OptionCorner = ImGui:CreateInstance("UICorner", Option)
			OptionCorner.CornerRadius = UDim.new(0, 3)
			
			local OptionLabel = ImGui:CreateInstance("TextLabel", Option)
			OptionLabel.Name = "Label"
			OptionLabel.Text = Value
			OptionLabel.Font = Enum.Font.Code
			OptionLabel.TextSize = 12
			OptionLabel.TextColor3 = Color3.new(1, 1, 1)
			OptionLabel.BackgroundTransparency = 1
			OptionLabel.Size = UDim2.new(1, Multi and -25 or -10, 1, 0)
			OptionLabel.Position = UDim2.new(0, 5, 0, 0)
			OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
			
			if Multi then
				local Checkbox = ImGui:CreateInstance("Frame", Option)
				Checkbox.Name = "Checkbox"
				Checkbox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
				Checkbox.BorderSizePixel = 0
				Checkbox.Size = UDim2.new(0, 14, 0, 14)
				Checkbox.Position = UDim2.new(1, -18, 0.5, -7)
				
				local CheckboxCorner = ImGui:CreateInstance("UICorner", Checkbox)
				CheckboxCorner.CornerRadius = UDim.new(0, 2)
				
				local Checkmark = ImGui:CreateInstance("TextLabel", Checkbox)
				Checkmark.Name = "Checkmark"
				Checkmark.Text = "✓"
				Checkmark.Font = Enum.Font.CodeBold
				Checkmark.TextSize = 12
				Checkmark.TextColor3 = Color3.fromRGB(125, 85, 255)
				Checkmark.BackgroundTransparency = 1
				Checkmark.Size = UDim2.new(1, 0, 1, 0)
				Checkmark.Visible = Class.Value[Value] or false
			end
			
			Option.MouseButton1Click:Connect(function()
				if Multi then
					Class.Value[Value] = not Class.Value[Value] or nil
					Option.Checkbox.Checkmark.Visible = Class.Value[Value] or false
					UpdateDisplay()
					Class.Callback(Class.Value)
				else
					Class.Value = Value
					UpdateDisplay()
					ToggleMenu()
					Class.Callback(Value)
				end
			end)
			
			--// Hover effect
			Option.MouseEnter:Connect(function()
				ImGui:Tween(Option, {BackgroundColor3 = Color3.fromRGB(45, 45, 45)})
			end)
			
			Option.MouseLeave:Connect(function()
				ImGui:Tween(Option, {BackgroundColor3 = Color3.fromRGB(35, 35, 35)})
			end)
		end
		
		for _, Value in ipairs(Values) do
			CreateOption(Value)
		end
		
		Button.MouseButton1Click:Connect(ToggleMenu)
		
		function Class:SetValue(NewValue)
			Class.Value = NewValue
			UpdateDisplay()
			Class.Callback(NewValue)
			return self
		end
		
		function Class:SetValues(NewValues)
			Class.Values = NewValues
			MenuScroll:ClearAllChildren()
			
			-- Recreate layout
			ImGui:CreateInstance("UIListLayout", MenuScroll, {
				Padding = UDim.new(0, 2),
				SortOrder = Enum.SortOrder.LayoutOrder
			})
			ImGui:CreateInstance("UIPadding", MenuScroll, {
				PaddingTop = UDim.new(0, 5),
				PaddingBottom = UDim.new(0, 5),
				PaddingLeft = UDim.new(0, 5),
				PaddingRight = UDim.new(0, 5)
			})
			
			for _, Value in ipairs(NewValues) do
				CreateOption(Value)
			end
			return self
		end
		
		function Class:GetValue()
			return Class.Value
		end
		
		UpdateDisplay()
		
		return Class
	end

	--// ============================================
	--// NEW: COLOR PICKER ELEMENT
	--// ============================================
	function ContainerClass:AddColorPicker(Class)
		Class = Class or {}
		local Name = Class.Name or "Color Picker"
		local Default = Class.Default or Color3.new(1, 1, 1)
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "ColorPicker"
		Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		Container.BorderSizePixel = 0
		Container.Size = UDim2.new(1, -10, 0, 30)
		Container.LayoutOrder = Class.LayoutOrder or 0
		Container.ClipsDescendants = false
		
		--// Corner
		local Corner = ImGui:CreateInstance("UICorner", Container)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Label
		local Label = ImGui:CreateInstance("TextLabel", Container)
		Label.Name = "Label"
		Label.Text = Name
		Label.Font = Enum.Font.Code
		Label.TextSize = 13
		Label.TextColor3 = Color3.new(1, 1, 1)
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(1, -60, 1, 0)
		Label.Position = UDim2.new(0, 10, 0, 0)
		Label.TextXAlignment = Enum.TextXAlignment.Left
		
		--// Color display
		local ColorDisplay = ImGui:CreateInstance("Frame", Container)
		ColorDisplay.Name = "Display"
		ColorDisplay.BackgroundColor3 = Default
		ColorDisplay.BorderSizePixel = 0
		ColorDisplay.Size = UDim2.new(0, 40, 0, 20)
		ColorDisplay.Position = UDim2.new(1, -50, 0.5, -10)
		
		local DisplayCorner = ImGui:CreateInstance("UICorner", ColorDisplay)
		DisplayCorner.CornerRadius = UDim.new(0, 3)
		
		local DisplayStroke = ImGui:CreateInstance("UIStroke", ColorDisplay)
		DisplayStroke.Color = Color3.fromRGB(60, 60, 60)
		DisplayStroke.Thickness = 1
		
		--// Button
		local Button = ImGui:CreateInstance("TextButton", ColorDisplay)
		Button.Name = "Button"
		Button.Text = ""
		Button.BackgroundTransparency = 1
		Button.Size = UDim2.new(1, 0, 1, 0)
		Button.ZIndex = 5
		
		--// Apply styles
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		--// Functionality
		Class.Value = Default
		Class.Callback = Class.Callback or NullFunction
		Class.Container = Container
		
		function Class:SetValue(NewColor)
			Class.Value = NewColor
			ColorDisplay.BackgroundColor3 = NewColor
			Class.Callback(NewColor)
			return self
		end
		
		function Class:GetValue()
			return Class.Value
		end
		
		--// Simple color picker (click to open more advanced picker would go here)
		Button.MouseButton1Click:Connect(function()
			-- This would open a full color picker modal
			-- For now, just cycle through some preset colors as demo
			local presets = {
				Color3.fromRGB(255, 0, 0),
				Color3.fromRGB(0, 255, 0),
				Color3.fromRGB(0, 0, 255),
				Color3.fromRGB(255, 255, 0),
				Color3.fromRGB(255, 0, 255),
				Color3.fromRGB(0, 255, 255),
				Color3.fromRGB(255, 255, 255),
			}
			
			local currentIndex = 1
			for i, color in ipairs(presets) do
				if Class.Value == color then
					currentIndex = i
					break
				end
			end
			
			currentIndex = (currentIndex % #presets) + 1
			Class:SetValue(presets[currentIndex])
		end)
		
		return Class
	end

	--// ============================================
	--// NEW: INPUT/TEXTBOX ELEMENT
	--// ============================================
	function ContainerClass:AddInput(Class)
		Class = Class or {}
		local Name = Class.Name or "Input"
		local Default = Class.Default or ""
		local Placeholder = Class.Placeholder or "Enter text..."
		local Numeric = Class.Numeric or false
		
		local Container = ImGui:CreateInstance("Frame", Frame)
		Container.Name = "Input"
		Container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		Container.BorderSizePixel = 0
		Container.Size = UDim2.new(1, -10, 0, 30)
		Container.LayoutOrder = Class.LayoutOrder or 0
		
		--// Corner
		local Corner = ImGui:CreateInstance("UICorner", Container)
		Corner.CornerRadius = UDim.new(0, 4)
		
		--// Label
		local Label = ImGui:CreateInstance("TextLabel", Container)
		Label.Name = "Label"
		Label.Text = Name
		Label.Font = Enum.Font.Code
		Label.TextSize = 13
		Label.TextColor3 = Color3.new(1, 1, 1)
		Label.BackgroundTransparency = 1
		Label.Size = UDim2.new(0.4, 0, 1, 0)
		Label.Position = UDim2.new(0, 10, 0, 0)
		Label.TextXAlignment = Enum.TextXAlignment.Left
		
		--// TextBox
		local TextBox = ImGui:CreateInstance("TextBox", Container)
		TextBox.Name = "TextBox"
		TextBox.Text = Default
		TextBox.PlaceholderText = Placeholder
		TextBox.Font = Enum.Font.Code
		TextBox.TextSize = 12
		TextBox.TextColor3 = Color3.new(1, 1, 1)
		TextBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
		TextBox.BorderSizePixel = 0
		TextBox.Size = UDim2.new(0.6, -20, 0, 22)
		TextBox.Position = UDim2.new(0.4, 5, 0.5, -11)
		TextBox.TextXAlignment = Enum.TextXAlignment.Left
		TextBox.ClearTextOnFocus = false
		
		local TextBoxCorner = ImGui:CreateInstance("UICorner", TextBox)
		TextBoxCorner.CornerRadius = UDim.new(0, 3)
		
		local TextBoxPadding = ImGui:CreateInstance("UIPadding", TextBox)
		TextBoxPadding.PaddingLeft = UDim.new(0, 5)
		TextBoxPadding.PaddingRight = UDim.new(0, 5)
		
		--// Apply styles
		ImGui:CheckStyles(Container, Class, WindowConfig.Colors)
		
		--// Functionality
		Class.Value = Default
		Class.Callback = Class.Callback or NullFunction
		Class.Container = Container
		Class.TextBox = TextBox
		
		TextBox.FocusLost:Connect(function(EnterPressed)
			local Text = TextBox.Text
			
			if Numeric then
				Text = tonumber(Text) or Default
				TextBox.Text = tostring(Text)
			end
			
			Class.Value = Text
			Class.Callback(Text, EnterPressed)
		end)
		
		function Class:SetValue(NewValue)
			Class.Value = NewValue
			TextBox.Text = tostring(NewValue)
			return self
		end
		
		function Class:GetValue()
			return Class.Value
		end
		
		--// Animations
		ImGui:ApplyAnimations(TextBox, "Inputs")
		
		return Class
	end

	--// ============================================
	--// ORIGINAL METHODS (keeping backward compatibility)
	--// ============================================
	function ContainerClass:AddButton2(Class)
		Class = Class or {}

		--// TODO
		local Name = Class.Name or "Button"
		local Button: TextButton = Prefabs.Button:Clone()

		self:NewInstance(Button, Class)

		Button.Text = Name

		--// Animations
		ImGui:ApplyAnimations(Button, "Buttons")

		--// Callback
		Class.Callback = Class.Callback or NullFunction
		Button.Activated:Connect(function()
			Class.Callback(Class)
		end)

		Class.Button = Button
		return Class
	end

	function ContainerClass:AddCheckbox(Class)
		Class = Class or {}

		--// Config
		local Name = Class.Name or "Checkbox"
		local Value = Class.Value or false
		local Checkbox: Frame = Prefabs.Checkbox:Clone()

		self:NewInstance(Checkbox, Class)
		Checkbox.Label.Text = Name

		--// Functions
		function Class:UpdateCheckbox(Enabled)
			Checkbox.Check.Checkmark.Visible = Enabled
		end
		Class:UpdateCheckbox(Value)

		Class.Value = Value
		Class.Callback = Class.Callback or NullFunction
		Class.Checkbox = Checkbox

		local CheckButton: TextButton = Checkbox.CheckButton
		CheckButton.Activated:Connect(function()
			Class.Value = not Class.Value
			Class:UpdateCheckbox(Class.Value)
			Class.Callback(Class.Value)
		end)

		return Class
	end

	function ContainerClass:AddList(Class)
		Class = Class or {}

		--// Config
		local Name = Class.Name or "List"
		local Values = Class.Values or {}
		local Selected = Class.Selected or ""
		local NoSearch = Class.NoSearch or false

		local List: Frame = Prefabs.List:Clone()
		self:NewInstance(List, Class)
		List.Label.Text = Name

		local ScrollingFrame: ScrollingFrame = List.ScrollingFrame
		local Template: Frame = ScrollingFrame.Template
		Template.Parent = nil

		local SearchBox: TextBox = List.SearchBar.TextBox
		SearchBox.Visible = not NoSearch

		--// Functions
		function Class:UpdateSearch()
			local Text: string = SearchBox.Text:lower()
			for _, Element: Frame in next, ScrollingFrame:GetChildren() do
				if not Element:IsA("Frame") then continue end

				local Hidden = Text ~= "" and not Element.Name:lower():find(Text)
				Element.Visible = not Hidden 
			end
		end
		SearchBox:GetPropertyChangedSignal("Text"):Connect(Class.UpdateSearch)

		function Class:UpdateSelected(Index: string)
			for _, Element: Frame in next, ScrollingFrame:GetChildren() do
				if not Element:IsA("Frame") then continue end

				local Selected = Element.Name == Index
				Element.Label.TextColor3 = Selected and Color3.new(1,1,1) or Color3.fromRGB(140, 140, 140)
			end
		end

		function Class:Add(Value)
			local Element: Frame = Template:Clone()
			Element.Name = Value
			Element.Label.Text = Value
			Element.Parent = ScrollingFrame

			local Button = Element.Button
			Button.Activated:Connect(function()
				Class.Selected = Value
				Class:UpdateSelected(Value)
				Class.Callback(Value)
			end)
		end
		Class.List = List
		Class.Callback = Class.Callback or NullFunction

		--// Add values
		for _, Value in next, Values do
			Class:Add(Value)
		end

		if Selected ~= "" then
			Class:UpdateSelected(Selected)
		end

		return Class
	end

	function ContainerClass:AddSlider2(Class)
		Class = Class or {}

		--// Config
		local Name = Class.Name or "Slider"
		local Min = Class.Min or 0
		local Max = Class.Max or 100
		local Rounding = Class.Rounding or 0
		local Slider: Frame = Prefabs.Slider:Clone()

		self:NewInstance(Slider, Class)

		--// Config slider
		Slider.Label.Text = Name

		local ScrollBar: Frame = Slider.ScrollBar
		local Bar: Frame = ScrollBar.Bar
		local Dragger: Frame = Bar.Dragger

		--// Functions
		local function Round(Number, Factor)
			local Result = math.floor(Number/Factor + (math.sign(Number) * 0.5)) * Factor
			if Rounding == 0 then
				return math.floor(Result)
			end
			return Result
		end

		function Class:Set(Number, NoCallback: false)
			Number = math.clamp(Round(Number, Rounding), Min, Max)
			Class.Value = Number

			--// Update scrollbar size
			local ValuePercent = (Number - Min) / (Max - Min)
			Bar.Size = UDim2.fromScale(ValuePercent, 1)

			local Display = Class.Display
			if Display then
				Slider.Display.Text = Display(Number)
			else
				Slider.Display.Text = tostring(Number)
			end

			if not NoCallback then
				Class.Callback(Number)
			end
		end

		Class.Callback = Class.Callback or NullFunction
		Class.Slider = Slider

		--// Events
		local Dragging = false
		Dragger.InputBegan:Connect(function(Input: InputObject, GameProcessed)
			if Input.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
			Dragging = true
		end)

		UserInputService.InputEnded:Connect(function(Input: InputObject)
			if Input.UserInputType ~= Enum.UserInputType.MouseButton1 then
				Dragging = false
			end
		end)

		UserInputService.InputChanged:Connect(function(Input: InputObject)
			if not Dragging then return end
			if Input.UserInputType ~= Enum.UserInputType.MouseMovement then return end

			local BarSize = ScrollBar.AbsoluteSize.X
			local MouseLocation = Mouse.X - ScrollBar.AbsolutePosition.X
			local Percent = math.clamp(MouseLocation / BarSize, 0, 1)

			Class:Set(Percent * (Max - Min) + Min)
		end)

		--// Values
		Class:Set(Class.Value or Min, true)

		return Class
	end

	function ContainerClass:AddInput2(Class)
		Class = Class or {}

		--// Config
		local Name = Class.Name or "Input"
		local Input: Frame = Prefabs.Input:Clone()

		self:NewInstance(Input, Class)
		Input.Label.Text = Name

		--// Values
		local TextBox: TextBox = Input.TextBox
		Class.Value = Class.Value or ""
		TextBox.Text = Class.Value

		Class.Callback = Class.Callback or NullFunction
		TextBox.FocusLost:Connect(function()
			Class.Value = TextBox.Text
			Class.Callback(TextBox.Text)
		end)

		--// Animations
		ImGui:ApplyAnimations(TextBox, "Inputs")

		Class.Input = Input
		return Class
	end

	function ContainerClass:AddSubHeader(Class)
		Class = Class or {}

		--// Config
		local Name = Class.Name or "Sub header"
		local SubHeader: TextLabel = Prefabs.SubHeader:Clone()

		self:NewInstance(SubHeader, Class)
		SubHeader.Text = Name

		Class.SubHeader = SubHeader
		return Class
	end

	return ContainerClass
end

--// Original ImGui methods continue below...
--// (Including all the animation, tween, dragging, resizing, window creation methods from the original file)

function ImGui:GetAnimation(Instant: false, TweenInfo: TweenInfo)
	if Instant then
		return TweenInfo.new(0)
	end
	return TweenInfo or ImGui.Animation
end

function ImGui:Tween(Instance: GuiObject, Properties, TweenInfo, Instant: false)
	local Tween = TweenService:Create(
		Instance, 
		self:GetAnimation(Instant, TweenInfo), 
		Properties
	)

	Tween:Play()
	return Tween
end

function ImGui:ConnectHover(Class)
	--// TODO
	local Parent = Class.Parent
	local OnInput = Class.OnInput

	--// Events
	local Connections = {}
	table.insert(Connections,Parent.MouseEnter:Connect(function()
		OnInput(true, {UserInputType = {Name = "MouseMovement"}})
	end))
	table.insert(Connections,Parent.MouseLeave:Connect(function()
		OnInput(false, {UserInputType = {Name = "MouseMovement"}})
	end))
	table.insert(Connections,Parent.InputBegan:Connect(function(Input)
		OnInput(true, Input)
	end))
	table.insert(Connections,Parent.InputEnded:Connect(function(Input)
		OnInput(false, Input)
	end))

	return Connections
end

function ImGui:ApplyAnimations(GuiObject: GuiObject, Type: string, Config)
	--// TODO
	Config = Config or {}
	local Animations = ImGui.Animations[Type]
	if not Animations then return end

	local OnExit = Config.OnExit
	local OnHover = Config.OnHover
	local Triggers = Config.Triggers or {
		Enter = "MouseEnter",
		Leave = "MouseLeave"
	}
	local Interactable = Config.Interactable ~= false

	self:ConnectHover({
		Parent = GuiObject,
		OnInput = function(MouseHovering, Input)
			if not Interactable then return end
			if Input.UserInputType.Name ~= "MouseMovement" then return end

			local Type = MouseHovering and "MouseEnter" or "MouseLeave"
			local TypeAnimations = Animations[Type]

			if OnHover and MouseHovering then
				OnHover()
			elseif OnExit and not MouseHovering then
				OnExit()
			end

			ImGui:Tween(GuiObject, TypeAnimations)
		end,
	})
end

function ImGui:ApplyDraggable(Window: Frame, TitleBar: Frame)
	TitleBar = TitleBar or Window.Content.TitleBar

	local Dragging, DragInput, DragStart, StartPos
	local function Update(input)
		local delta = input.Position - DragStart
		Window.Position = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + delta.X, StartPos.Y.Scale, StartPos.Y.Offset + delta.Y)
	end

	TitleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = input.Position
			StartPos = Window.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					Dragging = false
				end
			end)
		end
	end)

	TitleBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			DragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == DragInput and Dragging then
			Update(input)
		end
	end)
end

function ImGui:ApplyResizable(MinSize: Vector2, Window: Frame, Resize: TextButton, WindowConfig)
	local IsResizing = false
	local ResizeStart
	local StartSize

	Resize.InputBegan:Connect(function(Input)
		if Input.UserInputType ~= Enum.UserInputType.MouseButton1 then return end

		IsResizing = true
		ResizeStart = Vector2.new(Mouse.X, Mouse.Y)
		StartSize = Window.AbsoluteSize
	end)

	UserInputService.InputEnded:Connect(function(Input)
		if Input.UserInputType ~= Enum.UserInputType.MouseButton1 then
			IsResizing = false
		end
	end)

	UserInputService.InputChanged:Connect(function(Input)
		if not IsResizing then return end
		if Input.UserInputType ~= Enum.UserInputType.MouseMovement then return end

		local MousePosition = Vector2.new(Mouse.X, Mouse.Y)
		local Delta = MousePosition - ResizeStart
		local NewSize = StartSize + Delta

		NewSize = Vector2.new(
			math.max(NewSize.X, MinSize.X),
			math.max(NewSize.Y, MinSize.Y)
		)

		WindowConfig:SetSize(NewSize)
	end)
end

function ImGui:HeaderAnimate(Header: Frame, Open: boolean, NewVisibility: boolean, Header2, Button)
	local Content = Header.Parent
	local Children = Content:GetChildren()

	--// Open animation
	if not Open then
		for _, Child: Frame in next, Children do
			if Child == Header or Child == Header2 then continue end
			if not Child:IsA("GuiObject") then continue end

			Child.Visible = false
		end

		ImGui:Tween(Button, {
			Rotation = -90
		})
	else
		for _, Child: Frame in next, Children do
			if Child == Header or Child == Header2 then continue end
			if not Child:IsA("GuiObject") then continue end

			Child.Visible = true
		end

		ImGui:Tween(Button, {
			Rotation = 0
		})
	end
end

function ImGui:ApplyWindowSelectEffect(Window: Frame, TitleBar: Frame)
	local UIStroke: UIStroke = Window.UIStroke

	local Colors = {
		Selected = {
			BackgroundColor3 = Color3.fromRGB(25, 25, 25)
		},
		Deselected = {
			BackgroundColor3 = Color3.fromRGB(0, 0, 0)
		}
	}

	local function SetSelected(Selected)
		local Animations = ImGui.Animations
		local Type = Selected and "Selected" or "Deselected"
		local TweenInfo = ImGui:GetAnimation(true) 

		ImGui:Tween(TitleBar, Colors[Type])
		ImGui:Tween(UIStroke, Animations.WindowBorder[Type])
	end

	self:ConnectHover({
		Parent = Window,
		OnInput = function(MouseHovering, Input)
			if Input.UserInputType.Name:find("Mouse") then
				SetSelected(MouseHovering)
			end
		end,
	})
end

function ImGui:SetWindowProps(Properties, IgnoreWindows)
	local Module = {
		OldProperties = {}
	}

	--// Collect windows & set properties
	for Window in next, ImGui.Windows do
		if table.find(IgnoreWindows, Window) then continue end

		local OldValues = {}
		Module.OldProperties[Window] = OldValues

		for Key, Value in next, Properties do
			OldValues[Key] = Window[Key]
			Window[Key] = Value
		end
	end

	--// Revert to previous values
	function Module:Revert()
		for Window in next, ImGui.Windows do
			local OldValues = Module.OldProperties[Window]
			if not OldValues then continue end

			for Key, Value in next, OldValues do
				Window[Key] = Value
			end
		end
	end

	return Module
end

function ImGui:CreateWindow(WindowConfig)
	--// Create Window frame
	local Window: Frame = Prefabs.Window:Clone()
	Window.Parent = ImGui.ScreenGui
	Window.Visible = true
	WindowConfig.Window = Window

	local Content = Window.Content
	local Body = Content.Body

	--// Window Resize
	local Resize = Window.ResizeGrab
	Resize.Visible = WindowConfig.NoResize ~= true

	local MinSize = WindowConfig.MinSize or Vector2.new(160, 90)
	ImGui:ApplyResizable(
		MinSize, 
		Window, 
		Resize,
		WindowConfig
	)

	--// Title Bar
	local TitleBar: Frame = Content.TitleBar
	TitleBar.Visible = WindowConfig.NoTitleBar ~= true

	local Toggle = TitleBar.Left.Toggle
	Toggle.Visible = WindowConfig.NoCollapse ~= true
	ImGui:ApplyAnimations(Toggle.ToggleButton, "Tabs")

	local ToolBar = Content.ToolBar
	ToolBar.Visible = WindowConfig.TabsBar ~= false

	if not WindowConfig.NoDrag then
		ImGui:ApplyDraggable(Window)
	end

	--// Close Window 
	local CloseButton: TextButton = TitleBar.Close
	CloseButton.Visible = WindowConfig.NoClose ~= true

	function WindowConfig:Close()
		local Callback = WindowConfig.CloseCallback
		WindowConfig:SetVisible(false)
		if Callback then
			Callback(WindowConfig)
		end
		return WindowConfig
	end
	CloseButton.Activated:Connect(WindowConfig.Close)

	function WindowConfig:GetHeaderSizeY(): number
		local ToolbarY = ToolBar.Visible and ToolBar.AbsoluteSize.Y or 0
		local TitlebarY = TitleBar.Visible and TitleBar.AbsoluteSize.Y or 0
		return ToolbarY + TitlebarY
	end

	function WindowConfig:UpdateBody()
		local HeaderSizeY = self:GetHeaderSizeY()
		Body.Size = UDim2.new(1, 0, 1, -HeaderSizeY)
	end
	WindowConfig:UpdateBody()

	--// Open/Close
	WindowConfig.Open = true
	function WindowConfig:SetOpen(Open: true, NoAnimation: false)
		local WindowAbSize = Window.AbsoluteSize 
		local TitleBarSize = TitleBar.AbsoluteSize 

		self.Open = Open

		--// Call animations
		ImGui:HeaderAnimate(TitleBar, true, Open, TitleBar, Toggle.ToggleButton)
		ImGui:Tween(Resize, {
			TextTransparency = Open and 0.6 or 1,
			Interactable = Open
		}, nil, NoAnimation)
		ImGui:Tween(Window, {
			Size = Open and self.Size or UDim2.fromOffset(WindowAbSize.X, TitleBarSize.Y)
		}, nil, NoAnimation)
		ImGui:Tween(Body, {
			Visible = Open
		}, nil, NoAnimation)
		return self
	end

	function WindowConfig:SetVisible(Visible: boolean)
		Window.Visible = Visible 
		return self
	end

	function WindowConfig:SetTitle(Text)
		TitleBar.Left.Title.Text = tostring(Text)
		return self
	end
	function WindowConfig:Remove()
		Window:Remove()
		return self
	end

	Toggle.ToggleButton.Activated:Connect(function()
		local Open = not WindowConfig.Open
		WindowConfig.Open = Open
		return WindowConfig:SetOpen(Open)
	end)	

	function WindowConfig:CreateTab(Config)
		local Name = Config.Name or ""
		local TabButton = ToolBar.TabButton:Clone()
		TabButton.Name = Name
		TabButton.Text = Name
		TabButton.Visible = true
		TabButton.Parent = ToolBar
		Config.Button = TabButton

		local AutoSizeAxis = WindowConfig.AutoSize or "Y"
		local Content: Frame = Body.Template:Clone()
		Content.AutomaticSize = Enum.AutomaticSize[AutoSizeAxis]
		Content.Visible = Config.Visible or false
		Content.Name = Name
		Content.Parent = Body
		Config.Content = Content

		if AutoSizeAxis == "Y" then
			Content.Size = UDim2.fromScale(1, 0)
		elseif AutoSizeAxis == "X" then
			Content.Size = UDim2.fromScale(0, 1)
		end

		TabButton.Activated:Connect(function()
			WindowConfig:ShowTab(Config)
		end)

		function Config:GetContentSize()
			return Content.AbsoluteSize
		end

		--// Apply animations
		Config = ImGui:ContainerClass(Content, Config, Window)
		ImGui:ApplyAnimations(TabButton, "Tabs")

		--// Automatic sizes
		self:UpdateBody()
		if WindowConfig.AutoSize then
			Content:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
				local Size = Config:GetContentSize()
				self:SetSize(Size)
			end)
		end

		return Config
	end

	function WindowConfig:SetPosition(Position)
		Window.Position = Position
		return self
	end

	function WindowConfig:SetSize(Size)
		local HeaderSizeY = self:GetHeaderSizeY()

		if typeof(Size) == "Vector2" then
			Size = UDim2.fromOffset(Size.X, Size.Y)
		end

		--// Apply new size
		local NewSize = UDim2.new(
			Size.X.Scale,
			Size.X.Offset,
			Size.Y.Scale,
			Size.Y.Offset + HeaderSizeY
		)
		self.Size = NewSize
		Window.Size = NewSize

		return self
	end

	--// Tab change system 
	function WindowConfig:ShowTab(TabClass: SharedTable)
		local TargetPage: Frame = TabClass.Content

		--// Page animation
		if not TargetPage.Visible and not TabClass.NoAnimation then
			TargetPage.Position = UDim2.fromOffset(0, 5)
		end

		--// Hide other tabs
		for _, Page in next, Body:GetChildren() do
			Page.Visible = Page == TargetPage
		end

		--// Page animation
		ImGui:Tween(TargetPage, {
			Position = UDim2.fromOffset(0, 0)
		})
		return self
	end

	function WindowConfig:Center() --// Without an Anchor point
		local Size = Window.AbsoluteSize
		local Position = UDim2.new(0.5,-Size.X/2,0.5,-Size.Y/2)
		self:SetPosition(Position)
		return self
	end

	--// Load Style Configs
	WindowConfig:SetTitle(WindowConfig.Title or "Depso UI")

	if not WindowConfig.Open then
		WindowConfig:SetOpen(WindowConfig.Open or true, true)
	end

	ImGui.Windows[Window] = WindowConfig
	ImGui:CheckStyles(Window, WindowConfig, WindowConfig.Colors)

	--// Window section events
	if not WindowConfig.NoSelectEffect then
		ImGui:ApplyWindowSelectEffect(Window, TitleBar)
	end

	return ImGui:MergeMetatables(WindowConfig, Window)
end

function ImGui:CreateModal(Config)
	local ModalEffect = Prefabs.ModalEffect:Clone()
	ModalEffect.BackgroundTransparency = 1
	ModalEffect.Parent = ImGui.FullScreenGui
	ModalEffect.Visible = true

	ImGui:Tween(ModalEffect, {
		BackgroundTransparency = 0.6
	})

	--// Config
	Config = Config or {}
	Config.TabsBar = Config.TabsBar ~= nil and Config.TabsBar or false
	Config.NoCollapse = true
	Config.NoResize = true
	Config.NoClose = true
	Config.NoSelectEffect = true
	Config.Parent = ModalEffect

	--// Center
	Config.AnchorPoint = Vector2.new(0.5, 0.5)
	Config.Position = UDim2.fromScale(0.5, 0.5)

	--// Create Window
	local Window = self:CreateWindow(Config)
	Config = Window:CreateTab({
		Visible = true
	})

	--// Disable other windows
	local WindowManger = ImGui:SetWindowProps({
		Interactable = false
	}, {Window.Window})

	--// Close functions
	local WindowClose = Window.Close
	function Config:Close()
		local Tween = ImGui:Tween(ModalEffect, {
			BackgroundTransparency = 1
		})
		Tween.Completed:Connect(function()
			ModalEffect:Remove()
		end)

		WindowManger:Revert()
		WindowClose()
	end

	return Config
end

local GuiParent = IsStudio and PlayerGui or CoreGui
ImGui.ScreenGui = ImGui:CreateInstance("ScreenGui", GuiParent, {
	DisplayOrder = 9999,
	ResetOnSpawn = false
})
ImGui.FullScreenGui = ImGui:CreateInstance("ScreenGui", GuiParent, {
	DisplayOrder = 99999,
	ResetOnSpawn = false,
	ScreenInsets = Enum.ScreenInsets.None
})

return ImGui
